# 界面优化更新说明

## 更新时间
2025-11-04

## 更新内容

### 1. ✅ 修复中文显示问题
**问题**: 图表中的中文（如"价格曲线对比（同一坐标系）"、"顺丰价格"等）无法正常显示

**解决方案**: 
- 导入matplotlib的配置模块 `rcParams`
- 设置中文字体支持（微软雅黑、黑体、宋体等）
- 解决负号显示问题

**代码**:
```python
from matplotlib import rcParams

# 配置matplotlib中文显示
rcParams['font.sans-serif'] = ['Microsoft YaHei', 'SimHei', 'SimSun', 'Arial Unicode MS']
rcParams['axes.unicode_minus'] = False  # 解决负号显示问题
```

### 2. ✅ 调整图表布局
**改进**: 
- 将原来的单列布局改为左右两列布局
- 左侧：图表（占屏幕一半宽度）
- 右侧：数据表格（占屏幕一半宽度）

**布局代码**:
```python
# 创建左右两列布局：左侧图表，右侧表格
col_left, col_right = st.columns([1, 1])

with col_left:
    # 图表显示
    ...

with col_right:
    # 表格显示
    ...
```

### 3. ✅ 优化图表样式
**增强**:
- 设置图表大小为 `figsize=(8, 6)`
- 为每条曲线添加不同的标记点（圆形、方形、三角形）
- 增加网格线（透明度0.3）
- 优化字体大小和样式
- 添加图表关闭 `plt.close()` 避免内存泄漏

**样式改进**:
```python
fig = plt.figure(figsize=(8, 6))
plt.plot(x, sf_curve, label="顺丰价格", marker='o', markersize=4, linewidth=2)
plt.plot(x, qy_curve, label="企业价格", marker='s', markersize=4, linewidth=2)
plt.plot(x, new_curve, label=f"新价格(顺丰×{1+profit_pct/100.0:.2f})", marker='^', markersize=4, linewidth=2)
plt.xlabel("重量 (kg)", fontsize=12)
plt.ylabel("价格 (元)", fontsize=12)
plt.title(f"{div} - {dest} - {group}", fontsize=14, fontweight='bold')
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)
plt.tight_layout()
```

### 4. ✅ 添加数据表格显示
**新增功能**:
- 右侧显示完整的数据表格
- 表格包含所有计算点的价格数据
- 数据格式化显示（保留2位小数）
- 支持滚动查看（高度400px）
- 自适应容器宽度

**表格功能**:
```python
with col_right:
    st.write("### 数据表格")
    # 创建数据表格
    export_df = pd.DataFrame({
        "重量(kg)": x,
        "顺丰价格": sf_curve,
        "企业价格": qy_curve,
        f"新价格(顺丰×{1+profit_pct/100.0:.2f})": new_curve
    })
    # 格式化显示
    styled_df = export_df.copy()
    styled_df["顺丰价格"] = styled_df["顺丰价格"].apply(lambda v: f"{v:.2f}" if not np.isnan(v) else "—")
    styled_df["企业价格"] = styled_df["企业价格"].apply(lambda v: f"{v:.2f}" if not np.isnan(v) else "—")
    styled_df[f"新价格(顺丰×{1+profit_pct/100.0:.2f})"] = styled_df[f"新价格(顺丰×{1+profit_pct/100.0:.2f})"].apply(lambda v: f"{v:.2f}" if not np.isnan(v) else "—")
    
    st.dataframe(styled_df, use_container_width=True, height=400)
```

## 视觉效果对比

### 更新前:
- ❌ 中文显示为方框
- ❌ 图表占满整个宽度
- ❌ 没有数据表格
- ❌ 图表样式简单

### 更新后:
- ✅ 中文正常显示
- ✅ 图表占左侧一半宽度
- ✅ 右侧显示完整数据表格
- ✅ 图表增加标记点和网格
- ✅ 更专业的视觉呈现

## 使用说明

### 运行应用
```powershell
streamlit run streamlit_from_csv.py
```

### 功能说明
1. **左侧图表**: 可视化显示三条价格曲线的对比
2. **右侧表格**: 查看所有计算点的具体数值
3. **下载按钮**: 可导出CSV格式的数据

### 数据表格特点
- 显示29个重量点（从1kg到15kg，步长0.5kg）
- 每个重量点显示三种价格
- 格式化为2位小数
- 空值显示为"—"
- 支持滚动查看

## 技术要点

### 中文字体优先级
1. Microsoft YaHei（微软雅黑）- Windows默认中文字体
2. SimHei（黑体）- 备选字体
3. SimSun（宋体）- 备选字体
4. Arial Unicode MS - 备选字体

### 响应式布局
- 使用 `st.columns([1, 1])` 创建等宽两列
- 左右各占50%宽度
- 适应不同屏幕大小

### 性能优化
- 图表绘制后及时关闭 `plt.close()`
- 避免matplotlib内存泄漏
- 表格使用 `use_container_width=True` 自适应

## 文件清单

- ✏️ `streamlit_from_csv.py` - 主程序（已更新）
- 📄 `界面优化说明.md` - 本文档
- 🧪 `test_chinese.py` - 中文测试脚本（可删除）
- 🖼️ `test_chinese.png` - 测试图片（可删除）

---

**更新完成！现在界面更专业、数据展示更直观！** 🎉
