# 交互式图表更新说明

## 更新时间
2025-11-04

## 更新内容

### 1. ✅ 删除单点价格显示
**已删除**:
- 三个metric卡片（顺丰价格、企业价格、新价格）
- `st.subheader("单点价格")` 部分

**原因**: 简化界面，用户可以通过交互式图表的tooltip查看任意点的价格

### 2. ✅ 删除重量输入框
**已删除**:
- 第4列的重量(kg)输入框 `st.number_input("重量(kg)", ...)`
- 相关的单点价格计算逻辑 `point_price()` 函数调用

**效果**: 选择框从4列简化为3列（分区、目的地、日均区间）

### 3. ✅ 替换图表库：Matplotlib → Plotly
**从**:
```python
import matplotlib.pyplot as plt
from matplotlib import rcParams
```

**改为**:
```python
import plotly.graph_objects as go
```

**优势**:
- ✅ 原生交互式支持
- ✅ 鼠标悬停自动显示tooltip
- ✅ 支持缩放、平移、重置等操作
- ✅ 响应式设计，适配不同屏幕

### 4. ✅ 实现交互式Tooltip
**功能**: 鼠标移到曲线上，自动显示该点的重量和价格信息

**实现细节**:
```python
# 每条曲线都有自定义的hovertemplate
hovertemplate='<b>新价格</b><br>重量: %{x:.1f} kg<br>价格: %{y:.2f} 元<extra></extra>'
```

**Tooltip显示格式**:
```
顺丰价格
重量: 5.0 kg
价格: 17.00 元
```

### 5. ✅ 优化图表样式

#### 曲线样式
- **顺丰价格**: 蓝色 (#1f77b4) + 圆形标记 (○)
- **企业价格**: 橙色 (#ff7f0e) + 方形标记 (□)
- **新价格**: 绿色 (#2ca02c) + 三角形标记 (△)

#### 布局优化
```python
fig.update_layout(
    title=dict(text=f"{div} - {dest} - {group}", font=dict(size=16)),
    xaxis=dict(title='重量 (kg)', gridcolor='lightgray'),
    yaxis=dict(title='价格 (元)', gridcolor='lightgray'),
    legend=dict(orientation='h', yanchor='bottom', y=1.02),
    hovermode='closest',  # 鼠标悬停模式
    plot_bgcolor='white',  # 白色背景
    height=500  # 图表高度
)
```

### 6. ✅ 中文字体支持
通过Plotly的font参数配置中文字体：
```python
font=dict(size=16, family='Microsoft YaHei, SimHei, Arial')
```

## 界面对比

### 更新前
```
┌─────────────────────────────────────────┐
│ [分区] [目的地] [日均区间] [重量(kg)]    │
├─────────────────────────────────────────┤
│ 利润率: ____%                            │
├─────────────────────────────────────────┤
│ 单点价格:                                │
│ [顺丰: xx.xx] [企业: xx.xx] [新: xx.xx] │
├─────────────────────────────────────────┤
│ 价格曲线对比                             │
│ [静态图表 - matplotlib]  [数据表格]     │
└─────────────────────────────────────────┘
```

### 更新后
```
┌─────────────────────────────────────────┐
│ [分区] [目的地] [日均区间]               │
├─────────────────────────────────────────┤
│ 利润率: ____%                            │
├─────────────────────────────────────────┤
│ 价格曲线对比（同一坐标系）                │
│ [交互式图表 - Plotly]  [数据表格]       │
│  • 鼠标悬停显示tooltip                   │
│  • 支持缩放/平移                         │
└─────────────────────────────────────────┘
```

## 交互功能说明

### Plotly工具栏
图表右上角有工具栏，提供以下功能：
- 📷 **下载图片**: 保存图表为PNG格式
- 🔍 **缩放**: 框选区域放大查看
- ↔️ **平移**: 拖动图表查看不同区域
- 🏠 **重置**: 恢复到初始视图
- 📊 **自动缩放**: 自适应数据范围

### Tooltip交互
- **触发方式**: 鼠标移到曲线上
- **显示内容**: 
  - 曲线名称（加粗显示）
  - 重量值（1位小数）
  - 价格值（2位小数）
- **样式**: 白色背景 + 黑色边框
- **响应速度**: 即时显示

### 图例交互
- **单击图例**: 隐藏/显示对应曲线
- **双击图例**: 单独显示该曲线（隐藏其他）
- **悬停图例**: 高亮显示对应曲线

## 技术细节

### 依赖库
- **新增**: `plotly >= 5.0`
- **删除**: `matplotlib`（不再需要）

### 安装命令
```bash
pip install plotly
```

### Plotly优势
1. **交互性**: 内置缩放、平移、tooltip等功能
2. **性能**: 基于JavaScript，浏览器端渲染，响应快
3. **美观**: 现代化设计，专业的视觉效果
4. **易用**: API简洁，配置灵活

### 代码结构
```python
# 创建图表对象
fig = go.Figure()

# 添加多条曲线
fig.add_trace(go.Scatter(...))  # 顺丰价格
fig.add_trace(go.Scatter(...))  # 企业价格
fig.add_trace(go.Scatter(...))  # 新价格

# 配置布局
fig.update_layout(...)

# 在Streamlit中显示
st.plotly_chart(fig, use_container_width=True)
```

## 用户体验提升

### 简化操作
- ❌ 不再需要输入重量值
- ❌ 不再需要手动计算单点价格
- ✅ 鼠标移动即可查看任意点的价格

### 增强功能
- ✅ 可以对比多个重量点的价格
- ✅ 可以缩放查看细节
- ✅ 可以导出高清图片
- ✅ 可以交互式探索数据

### 视觉效果
- ✅ 现代化的图表样式
- ✅ 流畅的动画效果
- ✅ 清晰的标记点
- ✅ 专业的配色方案

## 文件清单

- ✏️ `streamlit_from_csv.py` - 主程序（已更新）
- 📄 `price_table.csv` - 数据文件
- 📋 `交互式图表更新说明.md` - 本文档
- 📋 `界面优化说明.md` - 之前的更新文档
- 📋 `修复说明.md` - CSV解析修复文档

## 运行方法

```powershell
streamlit run streamlit_from_csv.py
```

## 预期效果

✅ 界面更简洁（3个选择框 vs 4个）  
✅ 交互式图表（可缩放、平移、悬停）  
✅ Tooltip显示重量和价格  
✅ 支持下载图表为PNG  
✅ 中文正常显示  
✅ 数据表格仍在右侧显示  

---

**更新完成！用户体验大幅提升！** 🎉
